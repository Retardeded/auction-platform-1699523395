<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Profile</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link th:href="@{/css/search-bar.css}" rel="stylesheet" />
    <link th:href="@{/css/profile.css}" rel="stylesheet" />
    <link th:href="@{/css/user-profile.css}" rel="stylesheet" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.js"></script>

    <script th:src="@{/js/dropdown.js}"></script>
    <script th:src="@{/js/auction-search.js}"></script>

</head>
<body>

<nav class="navbar">
    <div class="search-container">
        <form action="/search" method="get" class="search-form">
            <input type="text" placeholder="What you search for..." name="search" th:value="${param.search}" class="search-input" />
            <input type="text" placeholder="Location..." name="location" th:value="${param.location}" class="location-input" />
            <input type="hidden" name="category" th:value="${param.category}" class="category-input" />
            <button type="submit" class="search-button">Search</button>
        </form>
    </div>
    <div class="navbar-right">
        <button onclick="window.location.href='/auctions/create';" class="create-auction-button">Create Auction</button>
        <div class="profile-container">
            <button class="profile-button" onclick="toggleDropdown()" th:text="${currentUser.email}">User Email</button>
            <div id="myDropdown" class="dropdown-content">
                <div class="dropdown-button" onclick="window.location.href='/profile';">
                    My Profile
                </div>
                <div class="dropdown-button" onclick="document.getElementById('logout-form').submit();">
                    Logout
                </div>
                <form id="logout-form" action="/logout" method="post" style="display: none;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <input type="submit" value="Logout" />
                </form>
            </div>
        </div>
        <div class="notification-container">
            <span class="notification-bell" onclick="toggleNotificationsDropdown()">ðŸ””</span>
            <span class="notification-count">0</span>
            <div id="notificationDropdown" class="notification-dropdown-content" style="display: none;">
            </div>
        </div>
    </div>
</nav>

<div class="layout-container">

    <div class="main-content">
        <div class="profile-details">
            <p><strong>Email:</strong> <span th:text="${profileUser.email}"></span></p>
            <p><strong>Username:</strong> <span th:text="${profileUser.username}"></span></p>
            <p><strong>First Name:</strong> <span th:text="${profileUser.firstName}"></span></p>
            <p><strong>Last Name:</strong> <span th:text="${profileUser.lastName}"></span></p>
            <p><strong>Location:</strong> <span th:text="${profileUser.location}"></span></p>
            <p><strong>Phone Number:</strong> <span th:text="${profileUser.phoneNumber}"></span></p>
        </div>

        <div class="feedback-section">
            <h2>Feedback</h2>
            <div th:if="${feedbackList.isEmpty()}" class="no-feedback-message">
                No feedback so far.
            </div>
            <div th:each="feedback : ${feedbackList}" class="feedback-container">
                <div th:if="${feedback.seller == profileUser}" class="feedback-item">
                    <div class="feedback-header">
                        <div class="feedback-username" th:text="${feedback.buyer.username}"></div>
                        <div class="feedback-rating-date">
                            <div th:text="${#temporals.format(feedback.dateOfBuyerFeedback, 'dd MMMM yyyy')}"></div>
                            <div th:text="${feedback.ratingByBuyer}"></div>
                        </div>
                    </div>
                    <div class="feedback-comment" th:text="${feedback.commentByBuyer}"></div>
                </div>
                <div th:if="${feedback.buyer == profileUser}" class="feedback-item">
                    <div class="feedback-header">
                        <div class="feedback-username" th:text="${feedback.seller.username}"></div>
                        <div class="feedback-rating-date">
                            <div th:text="${#temporals.format(feedback.dateOfSellerFeedback, 'dd MMMM yyyy')}"></div>
                            <div th:text="${feedback.ratingBySeller}"></div>
                        </div>
                    </div>
                    <div class="feedback-comment" th:text="${feedback.commentBySeller}"></div>
                </div>
            </div>
        </div>

    </div>
</div>
</body>
</html>